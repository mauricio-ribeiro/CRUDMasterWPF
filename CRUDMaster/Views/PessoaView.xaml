<Window x:Class="CRUDMaster.Views.PessoaView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:views="clr-namespace:CRUDMaster.Views"
             xmlns:enums="clr-namespace:CRUDMaster.Models.Enums"
             xmlns:converters="clr-namespace:CRUDMaster.Converters"
             mc:Ignorable="d" 
             WindowState="Maximized"
            WindowStartupLocation="CenterScreen"
        Title="Cadastro de Pessoas" Height="600" Width="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Filtros -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
            <TextBlock Text="Filtrar por Nome:" VerticalAlignment="Center" Margin="5"/>
            <TextBox Text="{Binding FiltroNome, UpdateSourceTrigger=PropertyChanged}" Width="150" Margin="5"/>
            <TextBlock Text="Filtrar por CPF:" VerticalAlignment="Center" Margin="5"/>
            <TextBox Text="{Binding FiltroCPF, UpdateSourceTrigger=PropertyChanged}" Width="150" Margin="5"/>
            <Button Content="Limpar Filtros" Command="{Binding LimparFiltrosCommand}" Margin="5" Width="100"/>
        </StackPanel>

        <!-- Botões de ação -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5">
            <Button Content="Novo" Command="{Binding NovoCommand}" Margin="5" Width="80"
                    IsEnabled="{Binding EmModoEdicao, Converter={StaticResource InverseBooleanConverter}}"/>
            <Button Content="Editar" Command="{Binding EditarCommand}" Margin="5" Width="80"
                    IsEnabled="{Binding EmModoEdicao, Converter={StaticResource InverseBooleanConverter}}"/>
            <Button Content="Salvar" Command="{Binding SalvarCommand}" Margin="5" Width="80"
                    IsEnabled="{Binding EmModoEdicao}"/>
            <Button Content="Cancelar" Command="{Binding CancelarCommand}" Margin="5" Width="80"
                    IsEnabled="{Binding EmModoEdicao}"/>
            <Button Content="Excluir" Command="{Binding ExcluirCommand}" Margin="5" Width="80"
                    IsEnabled="{Binding EmModoEdicao, Converter={StaticResource InverseBooleanConverter}}"/>
            <Button Content="Incluir Pedido" Command="{Binding IncluirPedidoCommand}" Margin="5" Width="100"
                    IsEnabled="{Binding EmModoEdicao, Converter={StaticResource InverseBooleanConverter}}"/>
        </StackPanel>

        <!-- Formulário de edição (visível apenas no modo de edição) -->
        <Border Grid.Row="2" Margin="5" Padding="10" BorderBrush="LightGray" BorderThickness="1"
                Visibility="{Binding EmModoEdicao, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Nome:" Grid.Row="0" Grid.Column="0" Margin="5"/>
                <TextBox Text="{Binding PessoaEmEdicao.Nome, UpdateSourceTrigger=PropertyChanged}" 
                         Grid.Row="0" Grid.Column="1" Margin="5"/>

                <TextBlock Text="CPF:" Grid.Row="1" Grid.Column="0" Margin="5"/>
                <TextBox Text="{Binding PessoaEmEdicao.CPF, UpdateSourceTrigger=PropertyChanged}" 
                         Grid.Row="1" Grid.Column="1" Margin="5"/>

                <TextBlock Text="Endereço:" Grid.Row="2" Grid.Column="0" Margin="5"/>
                <TextBox Text="{Binding PessoaEmEdicao.Endereco, UpdateSourceTrigger=PropertyChanged}" 
                         Grid.Row="2" Grid.Column="1" Margin="5"/>
            </Grid>
        </Border>

        <!-- Grid de pessoas (visível apenas fora do modo de edição) -->
        <DataGrid Grid.Row="2" 
                   ItemsSource="{Binding PessoasFiltradas}"
                  SelectedItem="{Binding PessoaSelecionada}" 
                  AutoGenerateColumns="False" CanUserAddRows="False" Margin="5"
                  Visibility="{Binding EmModoEdicao, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="Auto"/>
                <DataGridTextColumn Header="Nome" Binding="{Binding Nome}" Width="*"/>
                <DataGridTextColumn Header="CPF" Binding="{Binding CPF}" Width="*"/>
                <DataGridTextColumn Header="Endereço" Binding="{Binding Endereco}" Width="*"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Pedidos da pessoa selecionada -->
        <GroupBox Grid.Row="4" Header="PEDIDOS DA PESSOA" Margin="5">
            <Border Background="#FFF5F5F5" CornerRadius="3" Padding="5">
                <StackPanel>
                    <!-- Cabeçalho informativo -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="Total de Pedidos:" FontWeight="Bold"/>
                        <TextBlock Text="{Binding PedidosDaPessoa.Count}" FontWeight="Bold" Margin="5,0,0,0"/>
                        <TextBlock Text="| Valor Total:" FontWeight="Bold" Margin="10,0,0,0"/>
                        <TextBlock Text="{Binding TotalPedidos, StringFormat={}{0:C}}" 
                           FontWeight="Bold" Margin="5,0,0,0"/>
                    </StackPanel>

                    <!-- DataGrid com estilo de visualização -->
                    <DataGrid ItemsSource="{Binding PedidosDaPessoa}"
                      SelectedItem="{Binding PedidoSelecionado}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      SelectionMode="Single"
                      BorderThickness="0"
                      Background="Transparent"
                      RowBackground="#FAFAFA"
                      AlternatingRowBackground="White"
                      MaxHeight="300">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="Auto">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Padding" Value="5,2"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="DATA" Binding="{Binding DataVenda, StringFormat={}{0:dd/MM/yyyy}}" Width="Auto">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Padding" Value="5,2"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="VALOR TOTAL" Binding="{Binding ValorTotal, StringFormat={}{0:C}}" Width="Auto">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="5,2"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="STATUS" Binding="{Binding Status}" Width="Auto">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Padding" Value="5,2"/>
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="FORMA PAGAMENTO" Width="Auto">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="FormaPagamento">
                                        <Binding.Converter>
                                            <converters:EnumToDescriptionConverter/>
                                        </Binding.Converter>
                                    </Binding>
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Padding" Value="5,2"/>
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>

                        <!-- Estilo para indicar que é somente leitura -->
                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Focusable" Value="False"/>
                                <Setter Property="IsTabStop" Value="False"/>
                            </Style>
                        </DataGrid.CellStyle>

                        <!-- Cabeçalhos em caixa alta e negrito -->
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="5,2"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>
                    </DataGrid>
                </StackPanel>
            </Border>
        </GroupBox>
    </Grid>
</Window>