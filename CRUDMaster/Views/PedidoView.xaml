<Window x:Class="CRUDMaster.Views.PedidoView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:CRUDMaster.Views"
        xmlns:enums="clr-namespace:CRUDMaster.Models.Enums"
        xmlns:converters="clr-namespace:CRUDMaster.Converters"
        mc:Ignorable="d"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Title="Cadastro de Pedidos" Height="800" Width="1000">
   
    <Grid Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Filtros -->
            <RowDefinition Height="Auto"/>
            <!-- Botão Novo Pedido -->
            <RowDefinition Height="Auto"/>
            <!-- Campos Novo Pedido -->
            <RowDefinition Height="*"/>
            <!-- Lista de Pedidos -->
            <RowDefinition Height="250"/>
            <!-- Itens do Pedido Atual -->
            <RowDefinition Height="Auto"/>
            <!-- Total/Forma Pagamento -->
            <RowDefinition Height="Auto"/>
            <!-- Botões de Ação -->
        </Grid.RowDefinitions>

        <!-- Filtros -->
        <GroupBox Grid.Row="0" Header="Filtros" Margin="5">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Cliente:" VerticalAlignment="Center" Margin="5" Width="60"/>
                <TextBox Text="{Binding FiltroCliente, UpdateSourceTrigger=PropertyChanged}" Width="200" Margin="5"/>

                <TextBlock Text="Status:" VerticalAlignment="Center" Margin="5" Width="60"/>
                <ComboBox ItemsSource="{Binding StatusDisponiveis}" 
                  SelectedValue="{Binding FiltroStatus, UpdateSourceTrigger=PropertyChanged}"
                  SelectedValuePath="Key"
                  DisplayMemberPath="Value"
                  Width="120" Margin="5"/>  

                <TextBlock Text="Data Início:" VerticalAlignment="Center" Margin="5" Width="70"/>
                <DatePicker SelectedDate="{Binding FiltroDataInicio}" Width="120" Margin="5"/>

                <TextBlock Text="Data Fim:" VerticalAlignment="Center" Margin="5" Width="60"/>
                <DatePicker SelectedDate="{Binding FiltroDataFim}" Width="120" Margin="5"/>

                <Button Content="Limpar Filtros" Command="{Binding LimparFiltrosCommand}" Margin="5" Width="100"/>
            </StackPanel>
        </GroupBox>

        <!-- Novo Pedido -->
        <Button Grid.Row="1" Content="Novo Pedido" Command="{Binding NovoPedidoCommand}" 
                HorizontalAlignment="Left" Margin="5" Width="100"/>

        <!-- Campos do Novo Pedido -->
        <GroupBox Grid.Row="2" Header="Novo Pedido" Margin="5"
                  Visibility="{Binding MostrarCamposNovoPedido, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Seleção de Cliente -->
                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <TextBlock Text="Cliente:" VerticalAlignment="Center" Margin="5" Width="60"/>
                    <ComboBox ItemsSource="{Binding Pessoas}" DisplayMemberPath="Nome"
                              SelectedItem="{Binding PessoaSelecionada}" Width="300" Margin="5"/>
                </StackPanel>

                <!-- Adição de Produtos -->
                <StackPanel Grid.Row="1" Orientation="Horizontal">
                    <TextBlock Text="Produto:" VerticalAlignment="Center" Margin="5" Width="60"/>
                    <ComboBox ItemsSource="{Binding ProdutosDisponiveis}" DisplayMemberPath="Nome"
                              SelectedItem="{Binding ProdutoSelecionado}" Width="200" Margin="5"/>
                    <TextBlock Text="Quantidade:" VerticalAlignment="Center" Margin="5" Width="70"/>
                    <TextBox Text="{Binding Quantidade}" Width="50" Margin="5"/>
                    <Button Content="Adicionar" 
                    Command="{Binding AdicionarProdutoCommand}" 
                    Margin="5" Width="80"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Lista de Pedidos -->
        <GroupBox Grid.Row="3" Header="LISTA DE PEDIDOS" Margin="5">
            <DataGrid ItemsSource="{Binding PedidosFiltrados}"
                      SelectedItem="{Binding PedidoSelecionadoNaLista, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      SelectionMode="Single"
                      IsReadOnly="True">    
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="Auto"/>
                    <DataGridTextColumn Header="Cliente" Binding="{Binding PessoaNome}" Width="*"/>
                    <DataGridTextColumn Header="Forma Pagamento" Width="Auto">
                        <DataGridTextColumn.Binding>
                            <Binding Path="FormaPagamento">
                                <Binding.Converter>
                                    <converters:EnumToDescriptionConverter/>
                                </Binding.Converter>
                            </Binding>
                        </DataGridTextColumn.Binding>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Data" Binding="{Binding DataVenda, StringFormat={}{0:dd/MM/yyyy}}" Width="Auto"/>
                    <DataGridTextColumn Header="Valor Total" Binding="{Binding ValorTotal, StringFormat={}{0:C}}" Width="Auto"/>
                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="Auto"/>
                    <DataGridTextColumn Header="Itens" Binding="{Binding Produtos.Count}" Width="Auto"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Itens do Pedido Atual -->
        <!--<GroupBox Grid.Row="4" Header="Itens do Pedido Atual" Margin="5">
            <DataGrid ItemsSource="{Binding PedidoAtual.Produtos}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      Margin="0">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Produto" Binding="{Binding ProdutoNome}" Width="*"/>
                    <DataGridTextColumn Header="Valor Unitário" Binding="{Binding ValorUnitario, StringFormat={}{0:C}}" Width="Auto"/>
                    <DataGridTextColumn Header="Quantidade" Binding="{Binding Quantidade}" Width="Auto"/>
                    <DataGridTextColumn Header="Valor Total" Binding="{Binding ValorTotal, StringFormat={}{0:C}}" Width="Auto"/>
                    <DataGridTemplateColumn Header="Ações" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Remover" 
                                        Command="{Binding DataContext.RemoverProdutoCommand, 
                                                RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Margin="2" Width="80"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>-->

        <!-- Itens do Pedido Atual -->
        <GroupBox Grid.Row="4" Header="ITENS DO PEDIDO SELECIONADO" Margin="5">
            <Border Background="#FFF5F5F5" CornerRadius="3" Padding="5">
                <StackPanel>
                    <!-- Cabeçalho informativo -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="Pedido #" FontWeight="Bold"/>
                        <TextBlock Text="{Binding PedidoAtual.Id}" FontWeight="Bold" Margin="5,0,0,0"/>
                        <TextBlock Text="| Cliente:" FontWeight="Bold" Margin="10,0,0,0"/>
                        <TextBlock Text="{Binding PedidoAtual.PessoaNome}" Margin="5,0,0,0"/>
                        <TextBlock Text="| Total:" FontWeight="Bold" Margin="10,0,0,0"/>
                        <TextBlock Text="{Binding PedidoAtual.ValorTotal, StringFormat={}{0:C}}" Margin="5,0,0,0"/>
                    </StackPanel>

                    <!-- DataGrid com estilo de visualização -->
                    <DataGrid ItemsSource="{Binding PedidoAtual.Produtos}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      SelectionMode="Single"
                      BorderThickness="0"
                      Background="Transparent"
                      RowBackground="#FAFAFA"
                      AlternatingRowBackground="White"
                      MaxHeight="300">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="PRODUTO" Binding="{Binding ProdutoNome}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Padding" Value="5,2"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="VALOR UNITÁRIO" Binding="{Binding ValorUnitario, StringFormat={}{0:C}}" Width="Auto">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="5,2"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="QTD" Binding="{Binding Quantidade}" Width="Auto">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,2"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="VALOR TOTAL" Binding="{Binding ValorTotal, StringFormat={}{0:C}}" Width="Auto">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="5,2"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>

                        <!-- Estilo para indicar que é somente leitura -->
                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Focusable" Value="False"/>
                                <Setter Property="IsTabStop" Value="False"/>
                            </Style>
                        </DataGrid.CellStyle>

                        <!-- Cabeçalhos em caixa alta e negrito -->
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="5,2"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>
                    </DataGrid>

                    <!-- Rodapé com total -->
                    <Border Background="#EEE" Margin="0,5,0,0" Padding="5" CornerRadius="3">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="TOTAL DO PEDIDO:" FontWeight="Bold"/>
                            <TextBlock Text="{Binding PedidoAtual.ValorTotal, StringFormat={}{0:C}}" 
                               FontWeight="Bold" Margin="10,0,0,0" FontSize="14"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>
        </GroupBox>


        <!-- Forma de Pagamento e Valor Total -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Right" Margin="5">
            <TextBlock Text="Forma de Pagamento:" VerticalAlignment="Center" Margin="5"/>
            <ComboBox ItemsSource="{Binding FormasPagamento}" 
                       SelectedItem="{Binding PedidoAtual.FormaPagamento, UpdateSourceTrigger=PropertyChanged}"
                      Width="120" Margin="5"/>
            <TextBlock Text="Valor Total:" VerticalAlignment="Center" Margin="5"/>
            <TextBlock Text="{Binding PedidoAtual.ValorTotal, StringFormat={}{0:C}}" 
                       VerticalAlignment="Center" Margin="5" Width="100"/>
        </StackPanel>

        <!-- Botões de Ação -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Center" Margin="5">
            <Button Content="Finalizar Pedido" Command="{Binding FinalizarPedidoCommand}" 
                    Margin="5" Width="120" Height="30"
                     IsEnabled="{Binding PodeFinalizarPedido}"
                    Visibility="{Binding PedidoFinalizado, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}"/>

            <Button Content="Marcar como Pago" Command="{Binding AtualizarStatusCommand}" 
                    CommandParameter="{x:Static enums:StatusPedidoEnum.Pago}"
                    Margin="5" Width="120" Height="30"/>

            <Button Content="Marcar como Enviado" Command="{Binding AtualizarStatusCommand}" 
                    CommandParameter="{x:Static enums:StatusPedidoEnum.Enviado}"
                    Margin="5" Width="120" Height="30"/>

            <Button Content="Marcar como Recebido" Command="{Binding AtualizarStatusCommand}" 
                    CommandParameter="{x:Static enums:StatusPedidoEnum.Recebido}"
                    Margin="5" Width="120" Height="30"/>
        </StackPanel>
    </Grid>
</Window>